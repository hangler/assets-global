(function(e){"use strict";function t(){var e=d3.select(this),t=e.datum(),n=t.radius,r=t.label.split(/\s+/).reverse(),i=3,s=(t.label.length+r.length)/i,o=r.pop(),u=[o],a,f=0,l=1.1,c=e.text(null).append("tspan").text(o);while(o=r.pop()){u.push(o);a=u.join(" ");c.text(a);if(a.length>s&&c.node().getComputedTextLength()>n){u.pop();c.text(u.join(" "));u=[o];c=e.append("tspan").text(o);f++}}var h=.35-f*l/2,p=Math.floor(t.textCenter.x),d=Math.floor(t.textCenter.y);e.selectAll("tspan").attr("x",p).attr("y",d).attr("dy",function(e,t){return h+t*l+"em"})}function n(e,t){var n=new Array(e[1].length||0);for(var r=0;r<n.length;++r){n[r]=e[0]*e[1][r]+t[0]*t[1][r]}return n}function r(t,n,r,i){var s=[];for(var o=0;o<t.length;++o){s.push({x:0,y:0,count:0})}var u=32;for(var o=0;o<u;++o){var a=o*n/u;for(var f=0;f<u;++f){var l=f*r/u;var c={x:a,y:l};var h=[];for(var p=0;p<t.length;++p){if(e.distance(c,t[p])<=t[p].radius){h.push(p)}}if(h.length==1){var d=s[h[0]];d.x+=c.x;d.y+=c.y;d.count+=1}}}for(var o=0;o<t.length;++o){var d=s[o];if(d.count){t[o].textCenter={x:d.x/d.count,y:d.y/d.count}}else{t[o].textCenter={x:t[o].x,y:t[o].y}}}}function s(t){var n=[];for(var r=0;r<t.length;++r){for(var i=r+1;i<t.length;++i){var s=e.circleCircleIntersection(t[r],t[i]);for(var o=0;o<s.length;++o){var u=s[o];u.parentIndex=[r,i];n.push(u)}}}return n}e.venn=function(t,n,r){r=r||{};r.maxIterations=r.maxIterations||500;var i=r.lossFunction||e.lossFunction;var s=r.layoutFunction||e.greedyLayout;t=s(t,n);var o=new Array(2*t.length);for(var u=0;u<t.length;++u){o[2*u]=t[u].x;o[2*u+1]=t[u].y}var a=0;var f=e.fmin(function(e){a+=1;var r=new Array(t.length);for(var s=0;s<t.length;++s){r[s]={x:e[2*s],y:e[2*s+1],radius:t[s].radius,size:t[s].size}}return i(r,n)},o,r);var l=f.solution;for(u=0;u<t.length;++u){t[u].x=l[2*u];t[u].y=l[2*u+1]}return t};e.distanceFromIntersectArea=function(t,n,r){if(Math.min(t,n)*Math.min(t,n)*Math.PI<=r){return Math.abs(t-n)}return e.bisect(function(i){return e.circleOverlap(t,n,i)-r},0,t+n)};e.getDistanceMatrix=function(t,n){var r=[];for(var i=0;i<t.length;++i){r.push([]);for(var s=0;s<t.length;++s){r[i].push(0)}}for(i=0;i<n.length;++i){var o=n[i];if(o.sets.length!==2){continue}var u=o.sets[0],a=o.sets[1],f=Math.sqrt(t[u].size/Math.PI),l=Math.sqrt(t[a].size/Math.PI),c=e.distanceFromIntersectArea(f,l,o.size);r[u][a]=r[a][u]=c}return r};e.greedyLayout=function(t,n){function h(e,t){return t.size-e.size}function d(e){return e.set in p}function v(e,n){t[n].x=e.x;t[n].y=e.y;p[n]=true}var r={};for(var i=0;i<t.length;++i){r[i]=[];t[i].radius=Math.sqrt(t[i].size/Math.PI);t[i].x=t[i].y=0}for(i=0;i<n.length;++i){var s=n[i];if(s.sets.length!==2){continue}var o=s.weight==null?1:s.weight;var u=s.sets[0],a=s.sets[1];r[u].push({set:a,size:s.size,weight:o});r[a].push({set:u,size:s.size,weight:o})}var f=[];for(var l in r){if(r.hasOwnProperty(l)){var c=0;for(i=0;i<r[l].length;++i){c+=r[l][i].size*r[l][i].weight}f.push({set:l,size:c})}}f.sort(h);var p={};v({x:0,y:0},f[0].set);var m=e.getDistanceMatrix(t,n);for(i=1;i<f.length;++i){var g=f[i].set,y=r[g].filter(d);l=t[g];y.sort(h);if(y.length===0){throw"Need overlap information for set "+JSON.stringify(l)}var b=[];for(var w=0;w<y.length;++w){var E=t[y[w].set],S=m[g][y[w].set];b.push({x:E.x+S,y:E.y});b.push({x:E.x-S,y:E.y});b.push({y:E.y+S,x:E.x});b.push({y:E.y-S,x:E.x});for(var x=w+1;x<y.length;++x){var T=t[y[x].set],N=m[g][y[x].set];var C=e.circleCircleIntersection({x:E.x,y:E.y,radius:S},{x:T.x,y:T.y,radius:N});for(var k=0;k<C.length;++k){b.push(C[k])}}}var L=1e50,A=b[0];for(w=0;w<b.length;++w){t[g].x=b[w].x;t[g].y=b[w].y;var O=e.lossFunction(t,n);if(O<L){L=O;A=b[w]}}v(A,g)}return t};e.classicMDSLayout=function(t,n){var r=e.getDistanceMatrix(t,n);var i=mds.classic(r);for(var s=0;s<t.length;++s){t[s].x=i[s][0];t[s].y=i[s][1];t[s].radius=Math.sqrt(t[s].size/Math.PI)}return t};e.lossFunction=function(t,n){function i(e){return e.map(function(e){return t[e]})}var r=0;for(var s=0;s<n.length;++s){var o=n[s],u;if(o.sets.length==2){var a=t[o.sets[0]],f=t[o.sets[1]];u=e.circleOverlap(a.radius,f.radius,e.distance(a,f))}else{u=e.intersectionArea(i(o.sets))}var l=o.weight==null?1:o.weight;r+=l*(u-o.size)*(u-o.size)}return r};e.scaleSolution=function(e,t,n,r){var i=function(t){var n=Math.max.apply(null,e.map(function(e){return e[t]+e.radius})),r=Math.min.apply(null,e.map(function(e){return e[t]-e.radius}));return{max:n,min:r}};t-=2*r;n-=2*r;var s=i("x"),o=i("y"),u=t/(s.max-s.min),a=n/(o.max-o.min),f=Math.min(a,u),l=(t-(s.max-s.min)*f)/2,c=(n-(o.max-o.min)*f)/2;for(var h=0;h<e.length;++h){var p=e[h];p.radius=f*p.radius;p.x=r+l+(p.x-s.min)*f;p.y=r+c+(p.y-o.min)*f}return e};e.bisect=function(e,t,n,r){r=r||{};var i=r.maxIterations||100,s=r.tolerance||1e-10,o=e(t),u=e(n),a=n-t;if(o*u>0){throw"Initial bisect points must have opposite signs"}if(o===0)return t;if(u===0)return n;for(var f=0;f<i;++f){a/=2;var l=t+a,c=e(l);if(c*o>=0){t=l}if(Math.abs(a)<s||c===0){return l}}return t+a};e.fmin=function(e,t,r){r=r||{};var i=r.maxIterations||t.length*200,s=r.nonZeroDelta||1.1,o=r.zeroDelta||.001,u=r.minErrorDelta||1e-5,a=r.rho||1,f=r.chi||2,l=r.psi||-.5,c=r.sigma||.5,h=r.callback;var p=t.length,d=new Array(p+1);d[0]=t;d[0].fx=e(t);for(var v=0;v<p;++v){var m=t.slice();m[v]=m[v]?m[v]*s:o;d[v+1]=m;d[v+1].fx=e(m)}var g=function(e,t){return e.fx-t.fx};for(var y=0;y<i;++y){d.sort(g);if(h){h(d)}if(Math.abs(d[0].fx-d[p].fx)<u){break}var b=new Array(p);for(v=0;v<p;++v){b[v]=0;for(var w=0;w<p;++w){b[v]+=d[w][v]}b[v]/=p}var E=d[p];var S=n([1+a,b],[-a,E]);S.fx=e(S);var x=S;if(S.fx<=d[0].fx){var T=n([1+f,b],[-f,E]);T.fx=e(T);if(T.fx<S.fx){x=T}}else if(S.fx>=d[p-1].fx){var N=false;var C;if(S.fx<=E.fx){C=n([1+l,b],[-l,E]);C.fx=e(C);if(C.fx<E.fx){x=C}else{N=true}}else{C=n([1-l*a,b],[l*a,E]);C.fx=e(C);if(C.fx<=S.fx){x=C}else{N=true}}if(N){for(v=1;v<d.length;++v){d[v]=n([1-c,d[0]],[c-1,d[v]]);d[v].fx=e(d[v])}}}d[p]=x}d.sort(g);return{f:d[0].fx,solution:d[0]}};e.intersectionAreaPath=function(t){var n={};e.intersectionArea(t,n);var r=n.arcs;if(r.length===0){return"M 0 0"}var i=["\nM",r[0].p2.x,r[0].p2.y];for(var s=0;s<r.length;++s){var o=r[s],u=o.circle.radius,a=o.width>u;i.push("\nA",u,u,0,a?1:0,1,o.p1.x,o.p1.y)}return i.join(" ")};e.drawD3Diagram=function(n,i,s,o,u){u=u||{};var a=d3.scale.category10(),f="padding"in u?u.padding:6;i=e.scaleSolution(i,s,o,f);r(i,s,o);var l=n.append("svg").attr("width",s).attr("height",o);var c=l.append("g");var h=c.append("g").selectAll("circle").data(i).enter().append("g");var p=h.append("circle").attr("r",function(e){return e.radius}).style("fill-opacity",.3).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).style("fill",function(e,t){return a(t)});var d=h.append("text").attr("dy",".35em").attr("x",function(e){return Math.floor(e.textCenter.x)}).attr("y",function(e){return Math.floor(e.textCenter.y)}).attr("text-anchor","middle").style("fill",function(e,t){return a(t)}).call(function(e){e.each(t)});return{svg:l,nodes:h,circles:p,text:d}};e.updateD3Diagram=function(n,i,s){s=s||{};var o="padding"in s?s.padding:6,u="duration"in s?s.duration:400;var a=n.svg,f=parseInt(a.attr("width"),10),l=parseInt(a.attr("height"),10);i=e.scaleSolution(i,f,l,o);r(i,f,l);var c=n.nodes.data(i).transition().duration(u);c.select("circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",function(e){return e.radius});c.select("text").text(function(e){return e.label}).each("end",t).attr("x",function(e){return Math.floor(e.textCenter.x)}).attr("y",function(e){return Math.floor(e.textCenter.y)})};var i=1e-10;e.intersectionArea=function(t,n){var r=s(t);var o=r.filter(function(n){return e.containedInCircles(n,t)});var u=0,a=0,f=[],l;if(o.length>1){var c=e.getCenter(o);for(l=0;l<o.length;++l){var h=o[l];h.angle=Math.atan2(h.x-c.x,h.y-c.y)}o.sort(function(e,t){return t.angle-e.angle});var p=o[o.length-1];for(l=0;l<o.length;++l){var d=o[l];a+=(p.x+d.x)*(d.y-p.y);var v={x:(d.x+p.x)/2,y:(d.y+p.y)/2},m=null;for(var g=0;g<d.parentIndex.length;++g){if(p.parentIndex.indexOf(d.parentIndex[g])>-1){var y=t[d.parentIndex[g]],b=Math.atan2(d.x-y.x,d.y-y.y),w=Math.atan2(p.x-y.x,p.y-y.y);var E=w-b;if(E<0){E+=2*Math.PI}var S=w-E/2,x=e.distance(v,{x:y.x+y.radius*Math.sin(S),y:y.y+y.radius*Math.cos(S)});if(m===null||m.width>x){m={circle:y,width:x,p1:d,p2:p}}}}f.push(m);u+=e.circleArea(m.circle.radius,m.width);p=d}}else{var T=t[0];for(l=1;l<t.length;++l){if(t[l].radius<T.radius){T=t[l]}}var N=false;for(l=0;l<t.length;++l){if(e.distance(t[l],T)>Math.abs(T.radius-t[l].radius)){N=true;break}}if(N){u=a=0}else{u=T.radius*T.radius*Math.PI;f.push({circle:T,p1:{x:T.x,y:T.y+T.radius},p2:{x:T.x-i,y:T.y+T.radius},width:T.radius*2})}}a/=2;if(n){n.area=u+a;n.arcArea=u;n.polygonArea=a;n.arcs=f;n.innerPoints=o;n.intersectionPoints=r}return u+a};e.containedInCircles=function(t,n){for(var r=0;r<n.length;++r){if(e.distance(t,n[r])>n[r].radius+i){return false}}return true};e.circleIntegral=function(e,t){var n=Math.sqrt(e*e-t*t);return t*n+e*e*Math.atan2(t,n)};e.circleArea=function(t,n){return e.circleIntegral(t,n-t)-e.circleIntegral(t,-t)};e.distance=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))};e.circleOverlap=function(t,n,r){if(r>=t+n){return 0}if(r<=Math.abs(t-n)){return Math.PI*Math.min(t,n)*Math.min(t,n)}var i=t-(r*r-n*n+t*t)/(2*r),s=n-(r*r-t*t+n*n)/(2*r);return e.circleArea(t,i)+e.circleArea(n,s)};e.circleCircleIntersection=function(t,n){var r=e.distance(t,n),i=t.radius,s=n.radius;if(r>=i+s||r<=Math.abs(i-s)){return[]}var o=(i*i-s*s+r*r)/(2*r),u=Math.sqrt(i*i-o*o),a=t.x+o*(n.x-t.x)/r,f=t.y+o*(n.y-t.y)/r,l=-(n.y-t.y)*(u/r),c=-(n.x-t.x)*(u/r);return[{x:a+l,y:f-c},{x:a-l,y:f+c}]};e.getCenter=function(e){var t={x:0,y:0};for(var n=0;n<e.length;++n){t.x+=e[n].x;t.y+=e[n].y}t.x/=e.length;t.y/=e.length;return t}})(window.venn=window.venn||{})